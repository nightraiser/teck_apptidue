<link rel="stylesheet" type="text/css" href="<?php echo $this->baseUrl(); ?>/css/jquery.typeahead.css">
<style>
 form.main-search{width:780px;}
 .show-tick .dropdown-toggle{
  padding:8px;
  border-radius:3px 0 0 3px !important;
  background:#fff url(/images/location.png) no-repeat 8px 8px !important;
  padding-left: 30px !important;
  }
  .form-group1{
  margin-left:20px;
  width:120px !important
  }
 .form-group1 .show-tick .dropdown-toggle {
  padding: 8px;
  border-radius: 3px !important;
  background: none !important;
  padding-left: 0px !important;
  color: #fff;
 }
 .form-group1 .bootstrap-select .selectpicker .caret:after{
  color:#fff;
  }
 #searchCriteria{
  padding:8px;
  background:#fff url(/images/search1.png) no-repeat 4px 8px;
  padding-left: 30px !important;
  height:36px; 
  border-radius:0;
  border-left:0;
  }
 .search1{ 
  border-radius:0 3px 3px 0 !important;
  padding:8px;
 }
#searchLocation
{
	border-radius: 2px 0px 0 2px;
  margin-right: 0px;
  padding-right: 0px;
  height: 36px;
  background: #fff url(/images/location.png) no-repeat 4px 8px !important;
  padding-left: 25px;
}
 form.main-search{
  padding: 2px 0 0 0;
  }
 .search-bar.horizontal .main-search .input-row{
  margin-bottom: 0px !important;
  }
 #counter{
 background:url(/images/features_bg1.jpg) no-repeat top center;
 }
 .item.list .wrapper {
    display: inline-block;
    width: 67%;
}
.black-bg.framed .selectpicker
{
	background: transparent !important;
	color:white;
	border:1px solid white;
}
 </style>
 <script src="/js/jquery.typeahead.js" type="text/javascript"></script>
 <script>
 var searchLocations = Array();
function setLocations()
{
	if((localStorage['searchLocationsDB']!=null)&&(localStorage['searchLocationsDB']!=""))
	{
		searchLocations  = JSON.parse(localStorage['searchLocationsDB']);
		$.typeahead({
            input: "#searchLocation",
            minLength: false,
            maxItem: 5,
            maxItemPerGroup: 12,
            order: "asc",
            hint: true,
            //cache: true,
            searchOnFocus: true,
            group: ["division", "{{group}}"],
            display: ["name", "city"],
            correlativeTemplate: true,
            template: '<span>' +
            '<span class="name">{{name}}</span>'+
            '</span>',
            source: {
             Results: {
                    data: searchLocations
                }
            },
            debug: false
        });
	}
	 else
	 {
	 	var suggestionUrl  = "<?php echo $this->url(array('module'=>'Restaurant','controller'=>'Restaurant','action'=>'searchsugesstions'),'default',true); ?>";
        $.post(suggestionUrl,function(data)
        {
        	data = JSON.parse(data);
        	searchLocations = data['locations'];
     		localStorage['searchLocationsDB'] = JSON.stringify(data['locations']);
        	$.typeahead({
            input: "#searchLocation",
            minLength: false,
            maxItem: 5,
            maxItemPerGroup: 12,
            order: "asc",
            hint: true,
            //cache: true,
            searchOnFocus: true,
            group: ["division", "{{group}}"],
            display: ["name", "city"],
            correlativeTemplate: true,
            template: '<span>' +
            '<span class="name">{{name}}</span>'+
            '</span>',
            source: {
             Results: {
                    data: searchLocations
                }
            },
            debug: false
        });
        });
	 }
}
function storeSearch(key,gpid,criteria)
{
		var arr = {"key":key,"gpid":gpid,"criteria":criteria};
		localStorage['userSearch'] = JSON.stringify(arr);
}
function setSearch()
{
	if((localStorage['userSearch']!=null))
	{
		var data = JSON.parse(localStorage['userSearch']);
		$('#searchLocation').val(data['key']);
		$("#searchCriteria").val(data['criteria']);
	}
}
	$(document).ready(function(){
		setSearch();
		$('.primarySearch').click(function(){
			for(var i in searchLocations)
			{
				if(searchLocations[i]['name'] == $('#searchLocation').val())
				{
					location = searchLocations[i]['value'];
				}
			}
			var url = "/hyderabad";
			if($('#searchLocation').val()){
				var type = $(".search-option").val();
				if(type.length!==0)
				{
					url += '/'+type+"-"+$('#searchLocation').val().split(',')[0].toLowerCase().replace(" ","_")+"-restaurant";
				}
				else
				{
					url += '/'+$('#searchLocation').val().split(',')[0].toLowerCase().replace(" ","_")+"-restaurant";
				}

			}else{
				url += '';
			}
			if($('#searchCriteria').val()){
				url += '/'+$('#searchCriteria').val().replace("/","_");
			}else{
				url += '';
			}
			storeSearch($('#searchLocation').val(),location,$('#searchCriteria').val());
			window.location = url;
			return false;
		});
	});
</script>
 <script type="text/javascript">
 	$(window).load(function() {
  		// Animate loader off screen
  		$("#loading").fadeOut("slow");
 	});
 	$(document).ajaxStart(function(){
 		$("#loading").show();
 	});
 	$(document).ajaxComplete(function(){
 		$("#loading").hide();
 	});
 	$(window).on('beforeunload',function()
 	{
 		$("#loading").show();
 	});
</script>
<div class="loading-div fade_in" id="loading">
 	<span>
  		<img alt="loading.." src="/images/rdine-loading.gif" >
  		<h2>Discovering best restaurants for you...</h2>
 	</span>
</div>

<div class="header">
	<div class="wrapper">
		<div class="row">
			<div class="brand">
				<a href="<?php echo $this->url(array('module'=>'default','controller'=>'index','action'=>'index'),'default',true);?>"><img src="/images/logo.png" alt="logo"></a>
			</div>
			<div class="pull-left">
				<div class="search-bar horizontal">
					<form class="main-search border-less-inputs background-dark" role="form" method="post" action="?">
						<div class="input-row">
							<div class="form-group form-group1" style="width:140px; margin-left:30px;">
								 <select name="model" class="framed black-bg search-option"  title="Eat Out" data-live-search="true">
									<option value="">Eat Out</option>
									<option value="Buffet">Buffet</option>
									<option value="LuxuryDinner">Luxury Dinner</option>
									<option value="HomeDelivery">Home Delivery</option>
									<option value="Deals">Deals</option>
								</select>
							</div>
							 <div class="form-group" style="margin-right:0; width:280px;">
									<div class="typeahead-container">
												<div class="typeahead-field">
													<span class="typeahead-query location">
														<input id="searchLocation" name="searchLocation" type="search"  autocomplete="off" class="dropdown-toggle form-control"  placeholder="Search for location">
													</span>
												</div>
											</div>	
								</div>
								<!-- /.form-group -->
								<div class="form-group" style="margin-right:0;">
									<div class="typeahead-container">
												<div class="typeahead-field">
													<span class="typeahead-query location">
														<input id="searchCriteria" name="searchCriteria" type="search"  autocomplete="off" class="dropdown-toggle form-control"  placeholder="Search for restaurant, cuisine or a dish">
													</span>
												</div>
											</div>	
								</div>
								<!-- /.form-group -->
								<div class="form-group" style="margin-right:0;">
									<a class="btn btn-default search1 primarySearch"><i class="fa fa-search"></i> SEARCH</a>
								</div>
							<!-- /.form-group -->
						</div>
					</form>
					<!-- /.main-search -->
				</div>
			</div>
			<nav class="navigation-items">
				<div class="wrapper">
					<ul class="main-navigation navigation-top-header"></ul>
					
					<ul class="user-area">					
						<li>
							<?php 
							if($this->getUserName()){
								echo '<a><span style="color:#ffdb00; font-weight:bold;">Hi '.$this->getUserName().'!</span></a>';
							}else{
								echo '<a><span style="color:#ffdb00; font-weight:bold;">Hi '.$this->translate->_("Guest").'!</span></a>';
							} ?>
						</li>
					</ul>
					<div class="toggle-navigation">
						<div class="icon">
							<div class="line"></div>
							<div class="line"></div>
							<div class="line"></div>
						</div>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>
<script type="text/javascript">
$(function()
{
	setLocations();
	var searchCriteria = Array();
	 searchCriteria['cusines'] = [
	  {"value":"American ",name:"American "},{"value":"Asian ",name:"Asian "},{"value":"Bar/Club/Lounge",name:"Bar/Club/Lounge"},{"value":"BBQ ",name:"BBQ "},{"value":"Brazilian ",name:"Brazilian "},{"value":"Breakfast ",name:"Breakfast "},{"value":"Cajun/Creole ",name:"Cajun/Creole "},{"value":"Canadian ",name:"Canadian "},{"value":"Caribbean ",name:"Caribbean "},{"value":"Chinese ",name:"Chinese "},{"value":"Coffee/Desserts",name:"Coffee/Desserts"},{"value":"Continental ",name:"Continental "},{"value":"Deli ",name:"Deli "},{"value":"Eclectic ",name:"Eclectic "},{"value":"Ethiopian ",name:"Ethiopian "},{"value":"European ",name:"European "},{"value":"Fondue ",name:"Fondue "},{"value":"French ",name:"French "},{"value":"German ",name:"German "},{"value":"Greek ",name:"Greek "},{"value":"Indian ",name:"Indian "},{"value":"International ",name:"International "},{"value":"Italian ",name:"Italian "},{"value":"Japanese ",name:"Japanese "},{"value":"Kosher ",name:"Kosher "},{"value":"Latin ",name:"Latin "},{"value":"Mediterranean ",name:"Mediterranean "},{"value":"Mexican ",name:"Mexican "},{"value":"Middle Eastern ",name:"Middle Eastern "},{"value":"Pizza ",name:"Pizza "},{"value":"Polish ",name:"Polish "},{"value":"Pub Fare ",name:"Pub Fare "},{"value":"Seafood ",name:"Seafood "},{"value":"Southwestern ",name:"Southwestern "},{"value":"Spanish ",name:"Spanish "},{"value":"Steak ",name:"Steak "},{"value":"Sushi ",name:"Sushi "},{"value":"Tapas ",name:"Tapas "},{"value":"Test Cusine",name:"Test Cusine"},{"value":"Test Cusine",name:"Test Cusine"},{"value":"Thai ",name:"Thai "},{"value":"Vegetarian ",name:"Vegetarian "},{"value":"Vietnamese",name:"Vietnamese"}];
	  	searchCriteria['diningStyle'] = [{value:"Casual Elegant",name:"Casual Elegant"},{value:"Fine Dining",name:"Fine Dining"},{value:"Coffeehouse",name:"Coffeehouse"},{value:"Pizzeria",name:"Pizzeria"},{value:"Steakhouses",name:"Steakhouses"},{value:"Seafood Restaurants",name:"Seafood Restaurants"},{value:"Casual Dining",name:"Casual Dining"},{value:"Luxury Dinner",name:"Luxury Dinner"},];
     
         $.typeahead({
            input: "#searchCriteria",
            minLength: false,
            maxItem: 6,
            maxItemPerGroup: 3,
            minItemPerGroup:2,
            order: "asc",
            hint: true,
            //cache: true,
            searchOnFocus: false,
            group: ["division", "{{group}}"],
            display: ["name", "city"],
            correlativeTemplate: true,
            template: '<span>' +
            '<span class="name">{{name}}</span>'+
            '</span>',
            source: {
            	Types:
             {
             	data:searchCriteria['diningStyle']
             },
             Cusines: {
                    data: searchCriteria['cusines']
                }
            },
            debug: true
        });
     

});
	
</script>